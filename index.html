<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mexico Dice - Rule Demo (3 Players, 1 Round)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #0b1320;
    color: #f5f5f5;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    margin-top: 20px;
  }
  #container {
    margin-top: 10px;
    width: 900px;
    max-width: 95%;
    border: 2px solid #4e6cff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    background: #111827;
  }
  #message {
    min-height: 50px;
    margin-bottom: 15px;
    font-size: 18px;
  }
  #players {
    display: flex;
    justify-content: space-around;
    margin-top: 10px;
  }
  .player-card {
    width: 27%;
    padding: 10px;
    border-radius: 10px;
    background: #1f2937;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
    text-align: center;
    transition: transform 0.2s, box-shadow 0.2s, border 0.2s;
    border: 2px solid transparent;
  }
  .player-name {
    font-weight: bold;
    margin-bottom: 8px;
    font-size: 18px;
  }
  .dice-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 8px 0;
  }
  .die {
    width: 40px;
    height: 40px;
    background: #f9fafb;
    color: #111827;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 20px;
    box-shadow: 0 0 6px rgba(0,0,0,0.5);
  }
  .score {
    margin-top: 5px;
    font-size: 16px;
  }
  .status {
    margin-top: 5px;
    font-size: 14px;
    color: #9ca3af;
  }
  .active {
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(96,165,250,0.8);
    border-color: #60a5fa;
  }
  .loser {
    border-color: #f87171;
    box-shadow: 0 0 20px rgba(248,113,113,0.8);
  }
  .winner {
    border-color: #34d399;
    box-shadow: 0 0 20px rgba(52,211,153,0.8);
  }
  #control {
    margin-top: 15px;
  }
  #startBtn {
    padding: 8px 16px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    background: #2563eb;
    color: white;
    cursor: pointer;
  }
  #startBtn:disabled {
    background: #4b5563;
    cursor: not-allowed;
  }
  #rule-box {
    margin-top: 10px;
    font-size: 14px;
    color: #d1d5db;
  }
</style>
</head>
<body>
<h1>Mexico Dice – Rule Animation (3 Players, 1 Round)</h1>
<div id="container">
  <div id="message">Click "Start Demo" to see one example round.</div>
  <div id="players">
    <div class="player-card" id="p1">
      <div class="player-name">Player 1 (First)</div>
      <div class="dice-container">
        <div class="die" id="p1d1">-</div>
        <div class="die" id="p1d2">-</div>
      </div>
      <div class="score" id="p1score">Score: --</div>
      <div class="status" id="p1status">Waiting...</div>
    </div>
    <div class="player-card" id="p2">
      <div class="player-name">Player 2</div>
      <div class="dice-container">
        <div class="die" id="p2d1">-</div>
        <div class="die" id="p2d2">-</div>
      </div>
      <div class="score" id="p2score">Score: --</div>
      <div class="status" id="p2status">Waiting...</div>
    </div>
    <div class="player-card" id="p3">
      <div class="player-name">Player 3</div>
      <div class="dice-container">
        <div class="die" id="p3d1">-</div>
        <div class="die" id="p3d2">-</div>
      </div>
      <div class="score" id="p3score">Score: --</div>
      <div class="status" id="p3status">Waiting...</div>
    </div>
  </div>
  <div id="rule-box">
    <ul>
      <li>Two dice: score = bigger digit in front (e.g. 5 and 2 → 52).</li>
      <li>Each player may roll up to 3 times per round.</li>
      <li>The first player chooses when to stop; that roll number becomes the roll cap for everyone else.</li>
      <li>At the end of the round, the lowest score is eliminated.</li>
    </ul>
  </div>
</div>
<div id="control">
  <button id="startBtn">Start Demo</button>
</div>

<script>
// Helper: wait for ms
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

// Set UI text
function setMessage(text) {
  document.getElementById("message").textContent = text;
}

// Highlight current player
function setActivePlayer(playerId) {
  ["p1","p2","p3"].forEach(id => {
    const card = document.getElementById(id);
    card.classList.remove("active");
  });
  if (playerId) {
    document.getElementById(playerId).classList.add("active");
  }
}

// Update dice faces
function updateDice(player, d1, d2) {
  document.getElementById(player + "d1").textContent = d1;
  document.getElementById(player + "d2").textContent = d2;
}

// Compute Mexico score
function mexicoScore(d1, d2) {
  const a = Math.max(d1,d2);
  const b = Math.min(d1,d2);
  return 10*a + b;
}

// Update score + status text
function updateScore(player, score) {
  document.getElementById(player + "score").textContent = "Score: " + score;
}
function updateStatus(player, text) {
  document.getElementById(player + "status").textContent = text;
}

// Dice roll animation: flickering numbers then settle on given d1,d2
async function animateRoll(playerId, finalD1, finalD2, rollNumber, maxRollsPlayer) {
  setActivePlayer(playerId);
  const diceIds = [playerId + "d1", playerId + "d2"];
  const duration = 700;  // rolling time in ms
  const interval = 60;
  const steps = Math.floor(duration / interval);
  for (let i = 0; i < steps; i++) {
    diceIds.forEach(id => {
      document.getElementById(id).textContent = Math.floor(Math.random()*6)+1;
    });
    await sleep(interval);
  }
  // Final result
  updateDice(playerId, finalD1, finalD2);
  const score = mexicoScore(finalD1, finalD2);
  const playerScoreId = playerId + "score";
  document.getElementById(playerScoreId).textContent = "Score: " + score;
  updateStatus(playerId, `Roll ${rollNumber}/${maxRollsPlayer} → score ${score}`);
  return score;
}

// Main demo: scripted example to clearly show rules
async function runDemo() {
  const btn = document.getElementById("startBtn");
  btn.disabled = true;
  btn.textContent = "Playing...";

  // Reset visuals
  ["p1","p2","p3"].forEach(p => {
    document.getElementById(p + "d1").textContent = "-";
    document.getElementById(p + "d2").textContent = "-";
    document.getElementById(p + "score").textContent = "Score: --";
    document.getElementById(p + "status").textContent = "Waiting...";
    document.getElementById(p).classList.remove("loser","winner","active");
  });

  setMessage("Player 1 goes first. Up to 3 rolls this round.");

  // --- Scripted scenario for clarity ---
  // Player 1: Roll 1 -> 3 & 2 -> 32, chooses to roll again
  await sleep(800);
  setMessage("Player 1: first roll.");
  let p1_score = await animateRoll("p1", 3, 2, 1, 3);
  await sleep(900);
  updateStatus("p1", `Roll 1/3 → score ${p1_score} (too low, roll again)`);

  // Player 1: Roll 2 -> 6 & 4 -> 64, decides to stop
  await sleep(1200);
  setMessage("Player 1: second roll.");
  p1_score = await animateRoll("p1", 6, 4, 2, 3);
  await sleep(900);
  updateStatus("p1", `Roll 2/3 → score ${p1_score} (stops here)`);
  setMessage("Player 1 stops after 2 rolls → everyone else may roll at most 2 times.");

  const rollCap = 2;

  // Player 2: gets 2 rolls (cap = 2)
  let p2_score;
  await sleep(1500);
  setMessage("Player 2: up to 2 rolls (cap set by Player 1).");
  // Roll 1: 2 & 5 -> 52
  p2_score = await animateRoll("p2", 2, 5, 1, rollCap);
  await sleep(900);
  updateStatus("p2", `Roll 1/${rollCap} → score ${p2_score}`);
  // Roll 2: 1 & 1 -> 11 (final)
  await sleep(1200);
  setMessage("Player 2: second (and last) roll.");
  p2_score = await animateRoll("p2", 1, 1, 2, rollCap);
  await sleep(900);
  updateStatus("p2", `Roll 2/${rollCap} → final score ${p2_score}`);

  // Player 3: also gets 2 rolls
  let p3_score;
  await sleep(1500);
  setMessage("Player 3: also up to 2 rolls this round.");
  // Roll 1: 4 & 4 -> 44
  p3_score = await animateRoll("p3", 4, 4, 1, rollCap);
  await sleep(900);
  updateStatus("p3", `Roll 1/${rollCap} → score ${p3_score}`);
  // Roll 2: 5 & 5 -> 55
  await sleep(1200);
  setMessage("Player 3: second (and last) roll.");
  p3_score = await animateRoll("p3", 5, 5, 2, rollCap);
  await sleep(900);
  updateStatus("p3", `Roll 2/${rollCap} → final score ${p3_score}`);

  // Determine loser: lowest final score
  await sleep(1500);
  setActivePlayer(null);
  const scores = [
    { id: "p1", name: "Player 1", score: p1_score },
    { id: "p2", name: "Player 2", score: p2_score },
    { id: "p3", name: "Player 3", score: p3_score }
  ];
  scores.sort((a,b) => a.score - b.score);
  const loser = scores[0];
  const winner = scores[2];

  document.getElementById(loser.id).classList.add("loser");
  updateStatus(loser.id, `Lowest score: ${loser.score} → eliminated`);

  document.getElementById(winner.id).classList.add("winner");
  updateStatus(winner.id, `Highest score: ${winner.score}`);

  setMessage(`End of round: ${loser.name} is eliminated. The remaining players go to the next round.`);

  await sleep(3000);
  btn.disabled = false;
  btn.textContent = "Replay Demo";
}

document.getElementById("startBtn").addEventListener("click", runDemo);
</script>
</body>
</html>

